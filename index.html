<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>For You</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&family=Dancing+Script:wght@700&display=swap');

        body { margin: 0; overflow: hidden; background: #000; font-family: 'Montserrat', sans-serif; }
        canvas { display: block; width: 100vw; height: 100vh; }

        /* UI Overlay */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            z-index: 10;
        }

        .text-section {
            position: absolute;
            opacity: 0;
            transform: translateY(20px);
            transition: all 1s ease-out;
            pointer-events: auto;
        }

        h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            margin: 0;
            text-shadow: 0 0 20px rgba(255, 105, 180, 0.8);
            letter-spacing: 2px;
        }

        p {
            font-size: 1.2rem;
            letter-spacing: 4px;
            text-transform: uppercase;
            opacity: 0.8;
            margin-top: 10px;
        }

        .btn-group {
            margin-top: 30px;
            display: flex;
            gap: 20px;
            opacity: 0;
            transform: scale(0.9);
        }

        .btn {
            padding: 15px 40px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255, 192, 203, 0.1);
            color: white;
            font-size: 1.2rem;
            border-radius: 30px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.9);
            color: #ff4d6d;
            transform: scale(1.1);
        }

        .scroll-hint {
            position: absolute;
            bottom: 40px;
            font-size: 0.8rem;
            opacity: 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(10px); }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

    <div id="ui-layer">
        <div id="intro" class="text-section" style="opacity: 1; transform: translateY(0);">
            <p>Hey there...</p>
            <h1>Natalieüíê</h1>
            <div class="scroll-hint">Scroll down gently</div>
        </div>

        <div id="proposal" class="text-section" style="display:none;">
            <p>I have a question</p>
            <h1>Will you be my Valentine?</h1>
            <div class="btn-group">
                <button class="btn" id="yesBtn">Yes üåπ</button>
                <button class="btn btn-no" id="noBtn">No üôà</button>
            </div>
        </div>

        <div id="success" class="text-section" style="display:none;">
            <h1>I Love You Princessüíñ</h1>
            <p>Can't wait to see you.</p>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const config = {
            flowerCount: 300,
            petalCount: 200,
            fogColor: 0x1a0b14, 
            flowerColor: 0xff69b4, 
            goldenHour: 0xffd700
        };

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(config.fogColor, 0.035);
        scene.background = new THREE.Color(config.fogColor);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1, 5);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        const ambientLight = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambientLight);

        const sunLight = new THREE.DirectionalLight(config.goldenHour, 1.5);
        sunLight.position.set(10, 20, 10);
        scene.add(sunLight);

        const glowLight = new THREE.PointLight(config.flowerColor, 2, 20);
        glowLight.position.set(0, 2, 0);
        scene.add(glowLight);

        // --- OBJECTS ---
        const planeGeometry = new THREE.PlaneGeometry(100, 100, 32, 32);
        const planeMaterial = new THREE.MeshStandardMaterial({ color: 0x0a0508, roughness: 0.8 });
        const ground = new THREE.Mesh(planeGeometry, planeMaterial);
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        const stemMaterial = new THREE.MeshBasicMaterial({ color: 0x2e8b57 });
        const flowerMaterial = new THREE.MeshPhongMaterial({ 
            color: config.flowerColor, 
            emissive: 0xff0055,
            emissiveIntensity: 0.5,
            shininess: 100 
        });

        const gardenGroup = new THREE.Group();
        const flowerGeometry = new THREE.DodecahedronGeometry(0.2, 0);
        const stemGeometry = new THREE.CylinderGeometry(0.02, 0.02, 1, 5);

        for (let i = 0; i < config.flowerCount; i++) {
            const flowerGroup = new THREE.Group();
            const x = (Math.random() - 0.5) * 40;
            const z = (Math.random() - 0.5) * 80 - 10;
            flowerGroup.position.set(x, 0, z);

            const stem = new THREE.Mesh(stemGeometry, stemMaterial);
            stem.position.y = 0.5;
            stem.rotation.z = (Math.random() - 0.5) * 0.2;
            flowerGroup.add(stem);

            const flower = new THREE.Mesh(flowerGeometry, flowerMaterial);
            flower.position.y = 1;
            flower.scale.setScalar(0.5 + Math.random() * 0.5);
            flowerGroup.add(flower);

            flowerGroup.userData = { swaySpeed: 0.002 + Math.random() * 0.003, swayOffset: Math.random() * Math.PI * 2 };
            gardenGroup.add(flowerGroup);
        }
        scene.add(gardenGroup);

        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = config.petalCount;
        const posArray = new Float32Array(particlesCount * 3);
        for (let i = 0; i < particlesCount * 3; i++) { posArray[i] = (Math.random() - 0.5) * 50; }
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({ size: 0.15, color: 0xffd700, transparent: true, opacity: 0.8, blending: THREE.AdditiveBlending });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);

        // --- UPDATED SCROLL LOGIC ---
        let scrollY = 0;
        let maxScroll = 2000;
        let progress = 0;
        let touchStartY = 0;
        let introDismissed = false; // Flag to track if we've left the start

        const introDiv = document.getElementById('intro');
        const proposalDiv = document.getElementById('proposal');
        const scrollHint = document.querySelector('.scroll-hint');

        function handleScroll(delta) {
            scrollY += delta;
            scrollY = Math.max(0, Math.min(scrollY, maxScroll));
            updateScroll();
        }

        window.addEventListener('wheel', (e) => handleScroll(e.deltaY));
        window.addEventListener('touchstart', (e) => touchStartY = e.touches[0].clientY);
        window.addEventListener('touchmove', (e) => {
            const dy = touchStartY - e.touches[0].clientY;
            handleScroll(dy * 2);
            touchStartY = e.touches[0].clientY;
        });

        function updateScroll() {
            progress = scrollY / maxScroll;
            
            // Camera Move
            const targetZ = 5 - (progress * 15);
            const targetY = 1 + (Math.sin(progress * Math.PI) * 0.5);
            gsap.to(camera.position, { z: targetZ, y: targetY, duration: 1.5, ease: "power2.out" });

            // LOGIC CHANGE: If we scroll down past 10%, mark intro as dismissed
            if (progress > 0.1) {
                introDismissed = true;
            }

            // 1. Handle Intro Text (Only show if NOT dismissed)
            if (!introDismissed && progress < 0.2) {
                introDiv.style.opacity = 1 - (progress * 5);
                scrollHint.style.opacity = 1 - (progress * 5);
            } else {
                // Once dismissed, force opacity to 0
                introDiv.style.opacity = 0;
                scrollHint.style.opacity = 0;
            }

            // 2. Handle Proposal Text
            if (progress > 0.8) {
                introDiv.style.opacity = 0; // Ensure intro is gone
                proposalDiv.style.display = 'block';
                gsap.to(proposalDiv, { opacity: 1, y: 0, duration: 1, delay: 0.2 });
                gsap.to('.btn-group', { opacity: 1, scale: 1, duration: 0.8, delay: 0.8, ease: "back.out(1.7)" });
            } else {
                // If we scroll back UP away from the question, hide it
                gsap.to(proposalDiv, { opacity: 0, duration: 0.5 });
                gsap.to('.btn-group', { opacity: 0, duration: 0.5 });
                // Note: We don't set display:none immediately to allow fade out
            }
        }

        const clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();
            gardenGroup.children.forEach(flower => { flower.rotation.z = Math.sin(time * 2 + flower.userData.swayOffset) * 0.1; });
            particlesMesh.rotation.y = time * 0.05;
            particlesMesh.position.y = Math.sin(time * 0.5) * 0.5;
            renderer.render(scene, camera);
        }
        animate();

        const yesBtn = document.getElementById('yesBtn');
        const noBtn = document.getElementById('noBtn');
        const successDiv = document.getElementById('success');

        noBtn.addEventListener('mouseover', moveNoButton);
        noBtn.addEventListener('touchstart', moveNoButton);
        function moveNoButton() {
            const x = (Math.random() - 0.5) * 200;
            const y = (Math.random() - 0.5) * 200;
            gsap.to(noBtn, { x: x, y: y, duration: 0.3 });
        }

        yesBtn.addEventListener('click', () => {
            gsap.to(proposalDiv, { opacity: 0, scale: 0.8, duration: 0.5, onComplete: () => {
                proposalDiv.style.display = 'none';
                successDiv.style.display = 'block';
                gsap.fromTo(successDiv, { opacity: 0, scale: 0.5 }, { opacity: 1, scale: 1, duration: 1, ease: "elastic.out(1, 0.5)" });
            }});
            gsap.to(scene.fog, { density: 0.01, duration: 2 });
            gsap.to(scene.fog.color, { r: 1, g: 0.41, b: 0.7, duration: 2 });
            gsap.to(scene.background, { r: 1, g: 0.4, b: 0.7, duration: 2 });
            gardenGroup.children.forEach((flower, i) => {
                gsap.to(flower.scale, { x: 2, y: 2, z: 2, duration: 1, delay: i * 0.005, ease: "elastic.out(1, 0.3)" });
            });
            gsap.to(camera.rotation, { z: -0.2, duration: 3, ease: "power2.inOut", yoyo: true, repeat: 1 });
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        gsap.to('.scroll-hint', { opacity: 1, duration: 1, delay: 2 });
    </script>
</body>
</html>